#!/bin/sh

SCRIPT_ABSOLUTE_PATH="$( cd -- "$(dirname "$0")" >/dev/null 2>&1 ; pwd -P )"

# Load script dependencies
source "$SCRIPT_ABSOLUTE_PATH/config"
source "$SCRIPT_ABSOLUTE_PATH/helpers"

read -p "You are about to become limitless. Continue? (yes/no): " -n 1 -r

# Pre-validation
printf "\nStarting installation..."
printf "\nMaking sure the project can be installed..."
abortIfProjectFoldersExist $PROJECT_GUI_FOLDER $PROJECT_API_FOLDER $PROJECT_ANALYTICS_FOLDER

# Set installation path
cd "${SCRIPT_ABSOLUTE_PATH}" && cd ..
INSTALLATION_PATH=$(pwd)
INSTALLATION_PATH_GUI="${INSTALLATION_PATH}/${PROJECT_GUI_FOLDER}"
INSTALLATION_PATH_API="${INSTALLATION_PATH}/${PROJECT_API_FOLDER}"
INSTALLATION_PATH_ANALYTICS="${INSTALLATION_PATH}/${PROJECT_ANALYTICS_FOLDER}"

echo "Installation path set to: ${INSTALLATION_PATH}"

# Download git repositories
git clone git@github.com:condrici/limitless-gui.git "${INSTALLATION_PATH_GUI}"
git clone git@github.com:condrici/limitless-api.git "${INSTALLATION_PATH_API}"
git clone git@github.com:condrici/limitless-analytics.git "${INSTALLATION_PATH_ANALYTICS}"

echo "Preparing to fire up the docker containers..."

# Run Docker setup
cd "${INSTALLATION_PATH_API}" && docker-compose up -d
cd "${INSTALLATION_PATH_GUI}" && docker-compose up -d
cd "${INSTALLATION_PATH_ANALYTICS}" && docker-compose up -d

echo "Installation complete"
echo "Run docker logs <container name> to troubleshoot container issues"